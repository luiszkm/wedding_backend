ADR-002: Implementação de um Sistema Híbrido de Templates para Páginas de Eventos
Status: Aceito

Data: 2025-08-04

1. Contexto (Context)
Após definir um sistema inicial de personalização de páginas baseado em templates e paletas de cores pré-definidas, surgiu a necessidade de oferecer um nível de personalização ainda maior para casos especiais ou clientes premium. A funcionalidade proposta era permitir que uma página de evento tivesse um layout HTML totalmente único.

A discussão inicial considerou duas abordagens extremas:

Permitir que anfitriões (usuários finais) anexassem seus próprios arquivos HTML.

Permitir que um administrador/desenvolvedor anexasse um arquivo HTML estático.

A primeira abordagem foi rejeitada por unanimidade devido a riscos críticos de segurança (XSS), manutenibilidade e complexidade de infraestrutura. A segunda, embora mais segura, introduziu um problema de manutenibilidade severo, pois qualquer atualização em elementos globais do site (ex: cabeçalho, rodapé) exigiria a edição manual de todos os arquivos personalizados.

A decisão arquitetural, portanto, é sobre como reconciliar a necessidade de flexibilidade máxima com os requisitos não-negociáveis de segurança, manutenibilidade e escalabilidade da plataforma.

2. Decisão (Decision)
Decidimos implementar um sistema de templates híbrido, que suporta tanto a personalização padrão (baseada em opções pré-definidas) quanto a personalização avançada (baseada em layouts únicos criados pelo desenvolvedor), utilizando um motor de templates (Template Engine) no lado do servidor.

O plano de implementação é o seguinte:

Arquitetura de Renderização Híbrida: O sistema terá dois modos de renderização de página:

Modo Padrão: Utiliza um id_template (ex: 'template_moderno') para selecionar um layout e uma paleta de cores de um conjunto pré-definido no código. O conteúdo é preenchido a partir do banco de dados nos campos estruturados.

Modo Personalizado (Bespoke): Se um novo campo, id_template_arquivo, estiver preenchido no banco de dados para um evento, ele terá precedência. O sistema usará este campo para carregar um arquivo de template específico do sistema de arquivos do servidor (ex: templates/bespoke/cliente_xyz.html).

Uso de um Motor de Templates (Template Engine): Todos os templates, tanto os padrão quanto os personalizados, serão processados por um motor de templates (ex: Liquid, Handlebars, Jinja2, etc.). Isso permite:

Inclusão de Partials: Usar includes ({% include 'partials/header.html' %}) para garantir que elementos comuns como cabeçalhos, rodapés e menus sejam consistentes e fáceis de manter em um único lugar.

Injeção de Dados Segura: Injetar o conteúdo gerenciado pelo anfitrião (títulos, textos, etc.) nos templates de forma segura, prevenindo ataques de injeção de script.

Alterações no Banco de Dados:

A tabela paginas_de_eventos será modificada para incluir a nova coluna: id_template_arquivo VARCHAR(100) NULL DEFAULT NULL. A presença de um valor nesta coluna ativará o modo de renderização personalizado.

Processo para o Desenvolvedor:

Para criar uma página única, o desenvolvedor criará o novo arquivo de template, o colocará na pasta apropriada do projeto e, em seguida, atualizará o registro no banco de dados do cliente para apontar para este novo arquivo através do campo id_template_arquivo.

3. Consequências (Consequences)
Positivas:

Flexibilidade Máxima com Controle Total: Oferece a capacidade de criar layouts ilimitados para clientes especiais sem comprometer a integridade do sistema.

Manutenibilidade Garantida: A centralização de elementos comuns (cabeçalhos, rodapés) em "partials" resolve o principal problema de manutenção da abordagem de arquivos estáticos. Uma mudança em um partial se reflete em todas as páginas instantaneamente.

Segurança Robusta: A solução evita o upload de código pelo usuário e utiliza um motor de templates que, por padrão, "escapa" os dados injetados, eliminando o risco de XSS.

Experiência de Usuário Consistente: O anfitrião do evento continua usando o mesmo painel de administração familiar para gerenciar o conteúdo, independentemente do template utilizado.

Modelo de Negócio Flexível: Permite criar um nível "premium" de serviço, onde a criação de um template personalizado é oferecida como um upsell.

Negativas:

Dependência do Desenvolvedor: A criação de templates personalizados não é uma ação de autoatendimento; ela requer o trabalho de um desenvolvedor, o que cria um gargalo operacional.

Complexidade na Lógica de Renderização: O backend agora precisa de uma lógica condicional para decidir qual caminho de renderização seguir (padrão ou personalizado).

Processo de Deploy: Novos templates personalizados exigem um deploy (ou um método de upload seguro para o servidor de templates) para se tornarem disponíveis.

