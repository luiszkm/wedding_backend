# Testes de Presentes - Wedding API
# Inclui testes para presentes integrais e fracionados (ADR-004)

### Variáveis
@baseUrl = http://localhost:8080/v1
@authToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NjA0OTI3MjIsImlhdCI6MTc1OTg4NzkyMiwic3ViIjoiOGNiZjRhOWUtYTI0OS00YmRkLWI1NjItOWY3NWFlNzg3ZDIzIn0.QoqFlM8omlM_IyWNg6fXtWHUm0EouZHowho2ziPYF0U
@eventoId = 4c98ca52-eab3-4057-bd34-e5904a12cd56

###

# Criar presente integral
POST {{baseUrl}}/eventos/{{eventoId}}/presentes
Content-Type: multipart/form-data; boundary=boundary123
Authorization: Bearer {{authToken}}

--boundary123
Content-Disposition: form-data; name="presente"
Content-Type: application/json

{
  "nome": "Cafeteira Elétrica",
  "descricao": "Cafeteira elétrica 12 xícaras",
  "ehFavorito": false,
  "categoria": "COZINHA",
  "tipo": "INTEGRAL",
  "detalhes": {
    "tipo": "PRODUTO_EXTERNO",
    "linkDaLoja": "https://exemplo.com/cafeteira"
  }
}
--boundary123--

> {%
  client.global.set("presenteIntegralId", response.body.idPresente);
%}

###

# Criar presente fracionado
POST {{baseUrl}}/eventos/{{eventoId}}/presentes
Content-Type: multipart/form-data; boundary=boundary456
Authorization: Bearer {{authToken}}

--boundary456
Content-Disposition: form-data; name="presente"
Content-Type: application/json

{
  "nome": "Geladeira Frost Free",
  "descricao": "Geladeira 2 portas 400L",
  "ehFavorito": true,
  "categoria": "COZINHA", 
  "tipo": "FRACIONADO",
  "valorTotal": 2500.00,
  "numeroCotas": 10,
  "detalhes": {
    "tipo": "PRODUTO_EXTERNO",
    "linkDaLoja": "https://exemplo.com/geladeira"
  }
}
--boundary456--

> {%
  client.global.set("presenteFracionadoId", response.body.idPresente);
%}

###

# Listar presentes públicos
GET {{baseUrl}}/eventos/{{eventoId}}/presentes-publico

###

# Listar todos os presentes (Admin - Autenticado)
# Retorna presentes com informações de confirmação
# Presentes fracionados com múltiplas confirmações aparecem múltiplas vezes
GET {{baseUrl}}/eventos/{{eventoId}}/presentes
Authorization: Bearer {{authToken}}

# Resposta esperada:
# - Presentes INTEGRAIS: aparecem 1x (com selecao ou null)
# - Presentes FRACIONADOS: aparecem múltiplas vezes se houver várias confirmações
#   Exemplo:
#   [
#     {
#       "id": "uuid-geladeira",
#       "nome": "Geladeira",
#       "tipo": "FRACIONADO",
#       "cotasTotais": 10,
#       "selecao": {
#         "chaveDeAcesso": "familia-silva",
#         "quantidadeCotas": 5,
#         "valorConfirmado": 1250.00,
#         "dataSelecao": "2025-01-15T10:30:00Z"
#       }
#     },
#     {
#       "id": "uuid-geladeira",  # MESMO presente, outra confirmação
#       "nome": "Geladeira",
#       "tipo": "FRACIONADO",
#       "cotasTotais": 10,
#       "selecao": {
#         "chaveDeAcesso": "familia-santos",
#         "quantidadeCotas": 3,
#         "valorConfirmado": 750.00,
#         "dataSelecao": "2025-01-16T14:00:00Z"
#       }
#     }
#   ]

###

# Criar presente fracionado com mais cotas (para testes)
POST {{baseUrl}}/eventos/{{eventoId}}/presentes
Content-Type: multipart/form-data; boundary=boundary789
Authorization: Bearer {{authToken}}

--boundary789
Content-Disposition: form-data; name="presente"
Content-Type: application/json

{
  "nome": "Sofá 3 Lugares",
  "descricao": "Sofá retrátil e reclinável",
  "ehFavorito": false,
  "categoria": "SALA",
  "tipo": "FRACIONADO", 
  "valorTotal": 1800.00,
  "numeroCotas": 6,
  "detalhes": {
    "tipo": "PRODUTO_EXTERNO",
    "linkDaLoja": "https://exemplo.com/sofa"
  }
}
--boundary789--

> {%
  client.global.set("sofaId", response.body.idPresente);
%}